# HEAT v4.2 Release Notes

**Release Date:** February 9, 2026  
**Version:** 4.2 (They Are Here - Download Fix, Midnight Clock, Community Safety)

---

## üéØ Overview

HEAT v4.2 focuses on three main improvements:
1. **Fixed broken download links** and added professional poster-style report generation
2. **Social media scraper integration** (Reddit free, Twitter paid, Facebook CSV-import)
3. **Community Safety Hub** with actionable resources and **Time to Midnight** threat visualization

---

## ‚úÖ What's New

### 1. Download System Fixes & Enhancements

#### Fixed Broken Link IDs
- **Issue:** Download links weren't dynamically updating for CloudFront deployments
- **Fix:** Added proper `id` attributes to `<a>` elements in `index.html`:
  - `download-csv` - Simple CSV export
  - `download-json` - Simple JSON export  
  - `download-open` - Open JSON in browser
- **Result:** `updateDownloadSection()` in `app.js` correctly updates all hrefs with `getBaseUrl()`

#### New: Poster-Style Report Generator
- **Feature:** Generate printable A4/Letter reports for physical distribution
- **How to Use:** Click "üñ®Ô∏è Printable Report" button in Downloads section
- **Includes:**
  - Header with report date and region
  - Statistics panel (active clusters, total signals, trend, ZIPs affected)
  - Top 5 report groups with full details
  - Top keywords visualization
  - Source verification panel
  - Footer with disclaimer
- **Implementation:**
  - JavaScript function `generatePosterReport()` in `app.js`
  - Opens in new window with `window.print()` 
  - Print-optimized CSS with clean typography
  - No external dependencies (pure HTML/CSS)

#### Print Media CSS
- Added comprehensive `@media print` styles to `styles.css`
- Hides: navigation, map, interactive buttons, sidebar
- Formats: cluster cards, sections for clean page breaks
- Shows: link URLs in parentheses for verification

---

### 2. Social Media Scraper Integration

#### Reddit Scraper (Free, $0 cost)
- **Status:** ‚úÖ Fixed and wired into pipeline
- **Changes:**
  - Added graceful skip when no credentials available (returns `{"skipped": True}`)
  - Fixed subreddit capitalization (`PlainFieldNJ` documented)
  - Updated error messages to be informative, not fatal
  - Added to `run_pipeline.py` as **Step 2.5**
- **How to Enable:**
  ```powershell
  $env:REDDIT_CLIENT_ID="your_client_id"
  $env:REDDIT_CLIENT_SECRET="your_client_secret"
  ```
- **Covered Subreddits:**
  - r/newjersey, r/nj_politics
  - r/hoboken, r/newbrunswick, r/jerseycity, r/newark
  - r/immigration (national, may mention NJ)

#### Twitter/X Scraper (Paid, $100/mo)
- **Status:** ‚úÖ Updated and wired into pipeline
- **Changes:**
  - Verified API v2 compatibility
  - Added cost disclaimer in docstring (Basic tier $100/mo, free tier no longer supports search)
  - Graceful skip when credits depleted (HTTP 402)
  - Added to `run_pipeline.py` as **Step 2.6**
- **Note:** Requires paid API plan or account upgrade at [developer.x.com](https://developer.x.com)

#### Facebook Scraper (CSV-Import Mode)
- **Status:** ‚úÖ Updated to CSV-import primary mode
- **Changes:**
  - **Removed:** Broken HTML scraping mode (Facebook HTML changes too frequently)
  - **Primary Mode:** CSV import from manual browser exports
  - **Secondary Mode:** Graph API v19.0 for users with valid access tokens
  - Graceful skip when no CSV files or token available
  - Added to `run_pipeline.py` as **Step 2.7**
- **How to Use:**
  1. Use browser extension to export Facebook group posts to CSV
  2. Place CSV in `data/raw/` folder
  3. Pipeline automatically imports on next run

#### Data Source Freshness Disclaimer
- Added prominent notice in Sources section of `index.html`
- Text: "News sources may have delays. Social media signals (Reddit, X, Facebook) provide faster community reports when available."
- Dynamic source status indicator (populated by governance data)

---

### 3. Time to Midnight Clock Widget

#### Visual Concept
- Three circular clock faces (SVG) for North, Central, and South Jersey
- Clock hand position maps **composite civic attention score (0-100)** to time:
  - **6:00** = calm baseline (0 points)
  - **12:00** = midnight = maximum attention (100 points)
- Color gradient: Green ‚Üí Amber ‚Üí Red

#### Score Calculation
Composite score from 4 components:
1. **Recent signal volume** (last 7 days): Max 40 points
2. **Trend magnitude**: Max 30 points (negative if decreasing)
3. **Burst detection**: +15 points if recent burst detected
4. **Active alert level**: +15 points for high-priority alerts

#### Implementation
- **JavaScript:**
  - `computeMidnightScore(region)` - Calculate score
  - `renderMidnightClocks()` - Generate SVG clocks
  - Called during page initialization
- **HTML:** Section added to `index.html` before footer
- **CSS:** Clock card grid layout with hover effects in `styles.css`
- **Tooltip:** Shows exact score and interpretation on hover

#### User Interpretation
> "This clock reflects the combined intensity, trend, and recency of civic signals in [Region]. Closer to midnight = more active and escalating attention. **This is NOT a threat level** ‚Äî it reflects collective civic awareness."

---

### 4. Community Safety Hub

Replaces static "Know Your Rights" with actionable rapid-response resources.

#### Verified Resource Panel
- **Click-to-call hotlines:**
  - ACLU NJ Immigrant Rights: (855) 538-6111
  - United We Dream: (844) 363-1423
- **Direct links:**
  - NJ Alliance for Immigrant Justice
  - American Friends Service Committee NJ
  - Make the Road NJ
  - Email rapid response template
- **Verification badge:** "Resources verified February 2026"

#### Printable Safety Checklist
- **Interactive checkboxes** with 7 key actions:
  - Do not open door without judicial warrant
    - Exercise right to remain silent
  - Record badge numbers
  - Call emergency contacts immediately
  - Do not sign documents without attorney
  - Do not run or resist
  - Ask for bond hearing if detained
- **Print button:** Triggers `window.print()` for clean checklist output
- **Source citation:** Based on ACLU, NILC, National Immigration Law Center guidance

#### Shareable Neighbor Advisory
- **Auto-populates** with live data:
  - Active cluster count
  - Current trend (increasing/decreasing/stable)
  - Top ZIP codes affected
- **One-click copy to clipboard**
- **Pre-formatted** for text/WhatsApp sharing
- **Content:**
  ```
  ‚ö†Ô∏è COMMUNITY NOTICE ‚Äî New Jersey
  
  Recent civic attention in your region. What you should know:
  
  üìä Current Status: [X] active report groups
  üìà Trend: [increasing/stable/decreasing]
  üìç Areas: [ZIP codes]
  
  ‚úÖ WHAT TO DO: [guidance]
  ‚ùå WHAT NOT TO DO: [warnings]
  ```

#### Traditional Know Your Rights
- Full legal guidance collapsed in expandable `<details>` section
- Preserves all original content for users who need detailed reference

---

### 5. Bug Fixes

#### Critical: alerts.py Syntax Error
- **Issue:** Line 236 had corrupted dict literal (`{afe_s` instead of `{`)
- **Impact:** Entire alert engine crashed
- **Fix:** Corrected to proper opening brace `{`
- **File:** `processing/alerts.py`

---

## üóÇÔ∏è Files Modified

### Frontend (build/)
- `index.html` - Download link IDs, data freshness disclaimer, midnight clock section, Community Safety Hub
- `app.js` - Poster report generator, midnight clock functions, neighbor advisory updater
- `styles.css` - Print media styles, midnight clock widget CSS

### Backend (processing/)
- `reddit_scraper.py` - Graceful skip logic
- `facebook_scraper.py` - CSV-import primary mode
- `twitter_scraper.py` - API v2 verification, cost disclaimer
- `alerts.py` - Fixed syntax error at line 236

### Pipeline
- `run_pipeline.py` - Added Reddit, Twitter, Facebook as steps 2.5, 2.6, 2.7

### Documentation
- `README.md` - Updated with v4.2 features
- `V4.2_RELEASE_NOTES.md` - This file

### Cleanup
Removed redundant development files:
- `build/test_zip_validation.html`
- `tmpclaude-5b28-cwd`
- `IMPLEMENTATION_GUIDE_v4.md`
- `IMPLEMENTATION_NOTES.md`
- `IMPLEMENTATION_SUMMARY.md`
- `INTEGRATION_TEST_REPORT.md`
- `README_v4_IMPLEMENTATION.md`
- `ZIP_CODE_FIX_REPORT.md`
- `QUICK_REFERENCE_ZIP_MESSAGES.md`
- `FREE_SOURCES_ANALYSIS.md`

---

## üß™ Testing Checklist

### Download System
- [ ] Open `build/index.html` locally
- [ ] Click all download buttons (CSV, JSON, Metadata, Poster)
- [ ] Verify poster report opens in new window with print dialog
- [ ] Deploy to CloudFront and verify all links use correct base URL

### Scrapers
- [ ] Run `python run_pipeline.py --full`
- [ ] Verify Reddit scraper skips gracefully (without credentials) or runs (with credentials)
- [ ] Verify Twitter scraper shows cost warning
- [ ] Verify Facebook scraper processes CSV files in `data/raw/`
- [ ] Check `data/raw/` for new CSV files from scrapers

### Midnight Clock
- [ ] Load page, scroll to Time to Midnight section
- [ ] Verify 3 clocks render (North, Central, South)
- [ ] Hover each clock, verify tooltip shows score
- [ ] Check responsive layout on mobile

### Community Safety Hub
- [ ] Click hotline links, verify phone dialer opens
- [ ] Click "Print Checklist", verify clean print layout
- [ ] Click "Copy to Clipboard", verify neighbor advisory text copies
- [ ] Verify live data populates (cluster count, trend, ZIPs)

### Print Report
- [ ] Click "üñ®Ô∏è Printable Report"
- [ ] Verify clean A4/Letter layout with all sections
- [ ] Check page breaks avoid orphans/widows
- [ ] Verify source URLs appear in print output

### alerts.py Fix
- [ ] Run `python processing/alerts.py`
- [ ] Verify no SyntaxError
- [ ] Check `build/data/alerts.json` generated successfully

---

## üì¶ Deployment

### Local Testing
```bash
cd build
python -m http.server 8000
# Open http://localhost:8000
```

### CloudFront/S3
```bash
# Run full pipeline
python run_pipeline.py --full

# Deploy to S3 (if configured)
scripts/deploy_s3.bat
```

### Social Media Credentials (Optional)
```powershell
# Reddit (free)
$env:REDDIT_CLIENT_ID="your_client_id"
$env:REDDIT_CLIENT_SECRET="your_client_secret"

# Twitter (paid $100/mo)
$env:TWITTER_BEARER_TOKEN="your_token"

# Facebook (Graph API, optional)
$env:FACEBOOK_ACCESS_TOKEN="your_token"
```

---

## üöÄ Next Steps (Future Enhancements)

### Phase 3 Candidates
1. **Email alerts** - Extend notifier.py to use AWS SES
2. **Push notifications** - Service worker + Push API
3. **Cron automation** - Schedule scrapers hourly
4. **Opt-in form** - Web form for SMS subscriptions
5. **Multi-language neighbor advisory** - ES/PT translations
6. **Offline mode** - Service worker caching for PWA

---

## üìû Support

**Questions?** Open an issue at [GitHub repo]  
**Documentation:** See `README.md`, `STATUS.md`, `CHECKLIST.md`  
**License:** Ethical Use License - Open source, built for civic awareness

---

**Version:** 4.2  
**Codename:** Community Safety & Midnight Clock  
**Status:** ‚úÖ Ready for deployment  
**Last Updated:** February 9, 2026
